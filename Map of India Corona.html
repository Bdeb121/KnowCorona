<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Of India</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.js"></script>

    <link rel="stylesheet" href="css/jquery-jvectormap-2.0.5.css">

    <style>
        *{
          margin: 0;
          padding: 0;
          font-family: sans-serif;
        }
        #india-map{
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
    </style>
</head>
<body>

    <div id="india-map"></div>

    <script src="js/jquery-jvectormap-2.0.5.min.js"></script>
    <script src="js/jquery-jvectormap-india-merc.js"></script>

    <script>

        function loadmap(){

            $.ajax({

                url: "https://api.covid19india.org/data.json",

                error: function(){
                    alert("Problem with fetching data from API, Please try after sometime")
                },

                success: function(data) {

                    //console.log(data);

                    var Total_Case = {};
                    var Total_Active = {};
                    var Total_Cured = {};
                    var Total_Deaths = {};

                    var Today_Case = {};
                    var Today_Cured = {};
                    var Today_Deaths = {};

                    var Last_Updated_Time = {};


                    for(var i=0; i<(data['statewise'].length); i++) {

                        var elem = data['statewise'][i];
                        var India = "IN-" + data['statewise'][i].statecode;

                        Total_Case[India] = elem.confirmed;
                        Total_Active[India] = elem.active;
                        Total_Cured[India] = elem.recovered;
                        Total_Deaths[India] = elem.deaths;
                        
                        Today_Case[India] = elem.deltaconfirmed;
                        Today_Cured[India] = elem.deltarecovered;
                        Today_Deaths[India] = elem.deltadeaths;

                        Last_Updated_Time[India] = elem.lastupdatedtime;    

                    }

                    $('#india-map').vectorMap({
                        map: 'in_merc',
                        series: {
                            regions: [
                                {
                                    values: Total_Case,
                                    scale: ['#FFFFFF', '#FF0000'],
                                    normalizeFunction: 'polynomial'
                                }
                                
                            ]
                        },
                        backgroundColor: "#111", //#010f1a
                        onRegionTipShow: function(e, el, code){

                            //Math.round(parseFloat(Today_CountryWiseDeaths[code]) / parseFloat(Today_CountryWiseCase[code]) * 10000)/100 || 0
                            //Math.round(parseFloat((Today_CountryWiseDeaths[code]) / (Today_CountryWiseCase[code])) * 10000)/100 || 0
                            //parseFloat((Total_CountryWiseDeaths[code] / Total_CountryWiseCase[code]) *100).toFixed(2) || 0

                            var Today_Active = parseInt(Today_Case[code]) - parseInt(Today_Cured[code]) - parseInt(Today_Deaths[code]);

                            var Total_ActivePercentage = Math.round(parseFloat((Total_Active[code]) / (Total_Case[code])) * 10000)/100 || 0;
                            var Total_CuredPercentage = Math.round(parseFloat((Total_Cured[code]) / (Total_Case[code])) * 10000)/100 || 0;
                            var Total_DeathPercentage = Math.round(parseFloat((Total_Deaths[code]) / (Total_Case[code])) * 10000)/100 || 0;

                            var Today_ActivePercentage = Math.round(parseFloat((Today_Active) / (Today_Case[code])) * 10000)/100 || 0;
                            var Today_CuredPercentage = Math.round(parseFloat((Today_Cured[code]) / (Today_Case[code])) * 10000)/100 || 0;
                            var Today_DeathPercentage = Math.round(parseFloat((Today_Deaths[code]) / (Today_Case[code])) * 10000)/100 || 0;

                            var html = "<hr>";

                            html += "<br>1.Total &nbsp; Cases : &ensp;" + Total_Case[code];
                            html += "<br>2.Total &nbsp; Active : &ensp;" + Total_Active[code] + "&ensp;[" +Total_ActivePercentage+ " %]"; 
                            html += "<br>3.Total &nbsp; Cured : &ensp;" + Total_Cured[code] + "&ensp;[" +Total_CuredPercentage+ " %]" ;
                            html += "<br>4.Total &nbsp; Death : &ensp;" + Total_Deaths[code] + "&ensp;[" +Total_DeathPercentage+ " %]";

                            html += "<br><br>5.Today Cases : &ensp;" + Today_Case[code];
                            html += "<br>6.Today Active : &ensp;" + Today_Active + "&ensp;[" +Today_ActivePercentage+ " %]";
                            html += "<br>7.Today Cured : &ensp;" + Today_Cured[code] + "&ensp;[" +Today_CuredPercentage+ " %]";
                            html += "<br>8.Today Death : &ensp;" + Today_Deaths[code] + "&ensp;[" +Today_DeathPercentage+ " %]";

                            html += "<br><br>9.Last Updated : &ensp;" + Last_Updated_Time[code];

                            //html += "<br>4.Cured Rate : &ensp;" + CuredPercentage + "%";
                            //html += "<br>5.Death Rate : &ensp;" + DeathPercentage + "%";

                            el.html(el.html()+ html);
                        }
                    });

                    //console.log(countryWiseCase);

                }

            });

            //$('#world-map').vectorMap({map: 'world_merc'});
        }
        
        loadmap();

        setInterval(function(){
            loadmap();
        }, 60000);

    </script>


    
</body>
</html>